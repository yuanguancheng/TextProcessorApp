<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文本处理器</title>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/upload.css">
  <link rel="stylesheet" href="css/editor.css">
</head>

<body>
  <div class="container">
    <header>
      <h1>文本处理器</h1>
    </header>

    <main>
      <section class="upload-section" id="uploadSection">
        <h2>上传文本文件</h2>

        <!-- 文件上传区域 -->
        <div class="upload-area" id="uploadArea">
          <div class="upload-content">
            <div class="upload-icon">📁</div>
            <p class="upload-text">拖拽文件到此处或点击上传</p>
            <p class="upload-hint">仅支持 .txt 文件</p>
            <input type="file" id="fileInput" accept=".txt" hidden>
            <button class="upload-button" id="uploadButton">选择文件</button>
          </div>
        </div>

        <!-- 错误提示 -->
        <div class="error-message" id="errorMessage"></div>

        <!-- 文件信息显示 -->
        <div class="file-info" id="fileInfo" hidden>
          <h3>文件信息</h3>
          <p>文件名: <span id="fileName"></span></p>
          <p>文件大小: <span id="fileSize"></span></p>
          <p>文件类型: <span id="fileType"></span></p>
          <button class="process-button" id="processButton">处理文件</button>
        </div>

        <!-- 进度条 -->
        <div class="progress-container" id="progressContainer" style="display: none;">
          <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
          </div>
          <div class="progress-text" id="progressText">处理中...</div>
        </div>
      </section>

      <!-- 编辑器区域 -->
      <section class="editor-section" id="editorSection" hidden>
        <div class="editor-header">
          <h2>文本编辑器</h2>
          <div class="editor-controls">
            <button class="control-button" id="togglePreviewButton">显示/隐藏预览</button>
            <button class="control-button" id="backToUploadButton">返回上传</button>
          </div>
        </div>

        <div class="editor-container">
          <!-- 在index.html文件中，找到章节列表面板的部分，添加以下内容 -->
          <!-- 左侧章节列表 -->
          <div class="chapter-list-pane" id="chapterListPane">
            <div class="chapter-list-header">
              <h3>章节列表</h3>
              <div class="chapter-list-controls">
                <button class="chapter-list-button" id="expandAllButton" title="展开全部">▼</button>
                <button class="chapter-list-button" id="collapseAllButton" title="折叠全部">▲</button>
              </div>
            </div>
            <!-- 任务4：手动分章工具 -->
            <div class="manual-chapter-tools">
              <div class="tool-section">
                <h4>自定义规则</h4>
                <div class="custom-rule-input">
                  <input type="text" id="customRuleInput" class="form-input" placeholder="输入关键词或正则表达式">
                  <button id="applyCustomRuleButton" class="tool-button">应用</button>
                </div>
              </div>
              <div class="tool-section">
                <h4>章节操作</h4>
                <div class="chapter-operation-buttons">
                  <button id="splitChapterButton" class="tool-button" title="在光标位置拆分章节">拆分章节</button>
                  <button id="mergeChaptersButton" class="tool-button" title="合并选中的章节">合并章节</button>
                </div>
              </div>
            </div>
            <div class="chapter-list-content" id="chapterListContent">
              <div class="chapter-list-loading" id="chapterListLoading">
                <p>请先点击"章节检测"按钮</p>
              </div>
              <ul class="chapter-list" id="chapterList" style="display: none;">
                <!-- 章节列表将通过JavaScript动态生成 -->
                <!-- 在index.html文件中，找到章节列表项的生成部分，修改为以下内容 -->
                <!-- 章节列表项将通过JavaScript动态生成，但需要确保包含以下元素 -->
                <li class="chapter-item" data-index="CHAPTER_INDEX">
                  <input type="checkbox" class="chapter-checkbox">
                  <span class="chapter-number">CHAPTER_NUMBER.</span>
                  <span class="chapter-title" id="chapter-title-CHAPTER_INDEX">CHAPTER_TITLE</span>
                  <input type="text" class="chapter-title-input" id="chapter-title-input-CHAPTER_INDEX"
                    value="CHAPTER_TITLE" style="display: none;">
                  <button class="chapter-edit-button" id="chapter-edit-CHAPTER_INDEX" title="编辑章节名">✏️</button>
                  <button class="chapter-delete-button" id="chapter-delete-CHAPTER_INDEX" title="删除章节">🗑️</button>
                  <span class="chapter-toggle">▼</span>
                </li>

              </ul>
            </div>
          </div>

          <!-- 在index.html文件中，找到编辑器工具栏的部分，添加以下内容 -->
          <div class="editor-toolbar">
            <div class="toolbar-group">
              <button class="toolbar-button" id="undoButton" title="撤销">↶</button>
              <button class="toolbar-button" id="redoButton" title="重做">↷</button>
            </div>
            <div class="toolbar-group">
              <button class="toolbar-button" id="findButton" title="查找">🔍</button>
              <button class="toolbar-button" id="replaceButton" title="替换">⇄</button>
            </div>
            <div class="toolbar-group">
              <button class="toolbar-button" id="chapterDetectButton" title="章节检测">📖</button>
            </div>
            <!-- 任务2：内容优化工具 -->
            <div class="toolbar-group">
              <button class="toolbar-button" id="removeEmptyLinesButton" title="去空行">📝</button>
              <button class="toolbar-button" id="optimizeIndentButton" title="缩进优化">↹</button>
            </div>
          </div>
          <div class="editor-content">
            <textarea id="textEditor" placeholder="在此编辑文本内容..."></textarea>
          </div>
        </div>

        <!-- 右侧预览区 -->
        <div class="preview-pane" id="previewPane">
          <div class="preview-header">
            <h3>全文预览</h3>
            <div class="preview-controls">
              <button class="preview-button" id="zoomInButton">放大</button>
              <button class="preview-button" id="zoomOutButton">缩小</button>
              <button class="preview-button" id="resetZoomButton">重置</button>
            </div>
          </div>
          <div class="preview-content" id="previewContent">
            <div class="preview-text" id="previewText"></div>
          </div>
        </div>
  </div>

  <!-- 底部状态栏 -->
  <div class="status-bar">
    <div class="status-left">
      <span id="encodingInfo"></span>
      <span id="lineInfo"></span>
    </div>
    <div class="status-right">
      <span id="wordCount"></span>
    </div>
  </div>
  </section>
  </main>
  </div>

  <!-- 查找替换对话框 -->
  <div class="dialog" id="findReplaceDialog" hidden>
    <div class="dialog-content">
      <div class="dialog-header">
        <h3>查找与替换</h3>
        <button class="dialog-close" id="dialogClose">×</button>
      </div>
      <div class="dialog-body">
        <div class="form-group">
          <label for="findInput">查找内容:</label>
          <input type="text" id="findInput" class="form-input">
        </div>
        <div class="form-group">
          <label for="replaceInput">替换为:</label>
          <input type="text" id="replaceInput" class="form-input">
        </div>
        <div class="form-options">
          <label class="checkbox-label">
            <input type="checkbox" id="caseSensitive"> 区分大小写
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="wholeWord"> 全词匹配
          </label>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="dialog-button" id="findNextButton">查找下一个</button>
        <button class="dialog-button" id="replaceNextButton">替换下一个</button>
        <button class="dialog-button" id="replaceAllButton">全部替换</button>
      </div>
    </div>
  </div>

  <script src="js/fileHandler.js"></script>
  <script src="js/chapterDetector.js"></script>
  <script src="js/editor.js"></script>
  <script src="js/app.js"></script>
</body>

</html>