<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文本处理器</title>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/upload.css">
  <link rel="stylesheet" href="css/editor.css">
</head>

<body>
  <div class="container">
    <header>
      <h1>文本处理器</h1>
    </header>

    <main>
      <!-- 任务1：多文档管理界面 -->
      <section class="document-manager-section" id="documentManagerSection">
        <h2>文档管理</h2>
        <div class="document-manager-controls">
          <button class="control-button" id="newDocumentButton">新建文档</button>
          <button class="control-button" id="uploadDocumentButton">上传文档</button>
          <button class="control-button" id="refreshDocumentsButton">刷新列表</button>
        </div>

        <div class="document-list" id="documentList">
          <div class="document-list-loading" id="documentListLoading">
            <p>加载中...</p>
          </div>
          <div class="document-list-content" id="documentListContent" style="display: none;">
            <table class="document-table">
              <thead>
                <tr>
                  <th>文件名</th>
                  <th>上传时间</th>
                  <th>最后编辑</th>
                  <th>章节数</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="documentTableBody">
                <!-- 文档列表将通过JavaScript动态生成 -->
              </tbody>
            </table>
          </div>
          <div class="document-list-empty" id="documentListEmpty" style="display: none;">
            <p>暂无保存的文档</p>
          </div>
        </div>
      </section>

      <section class="upload-section" id="uploadSection" style="display: none;">
        <h2>上传文本文件</h2>

        <!-- 文件上传区域 -->
        <div class="upload-area" id="uploadArea">
          <div class="upload-content">
            <div class="upload-icon">📁</div>
            <p class="upload-text">拖拽文件到此处或点击上传</p>
            <p class="upload-hint">仅支持 .txt 文件</p>
            <input type="file" id="fileInput" accept=".txt" hidden>
            <button class="upload-button" id="uploadButton">选择文件</button>
          </div>
        </div>

        <!-- 错误提示 -->
        <div class="error-message" id="errorMessage"></div>

        <!-- 文件信息显示 -->
        <div class="file-info" id="fileInfo" hidden>
          <h3>文件信息</h3>
          <p>文件名: <span id="fileName"></span></p>
          <p>文件大小: <span id="fileSize"></span></p>
          <p>文件类型: <span id="fileType"></span></p>
          <button class="process-button" id="processButton">处理文件</button>
        </div>

        <!-- 进度条 -->
        <div class="progress-container" id="progressContainer" style="display: none;">
          <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
          </div>
          <div class="progress-text" id="progressText">处理中...</div>
        </div>
      </section>

      <!-- 编辑器区域 -->
      <section class="editor-section" id="editorSection" hidden>
        <div class="editor-header">
          <button class="mobile-menu-button" id="mobileMenuButton" title="显示/隐藏章节列表">☰</button>
          <h2>文本编辑器</h2>
          <div class="editor-controls">
            <button class="control-button" id="togglePreviewButton">显示/隐藏预览</button>
            <button class="control-button" id="readingModeButton">阅读模式</button>
            <button class="control-button" id="backToUploadButton">返回上传</button>
          </div>
        </div>

        <div class="editor-container">
          <!-- 移动端章节列表遮罩 -->
          <div class="chapter-list-overlay" id="chapterListOverlay"></div>

          <!-- 左侧章节列表 -->
          <div class="chapter-list-pane" id="chapterListPane">
            <div class="chapter-list-header">
              <h3>章节列表</h3>
              <div class="chapter-list-controls">
                <button class="chapter-list-button" id="expandAllButton" title="展开全部">▼</button>
                <button class="chapter-list-button" id="collapseAllButton" title="折叠全部">▲</button>
              </div>
            </div>
            <!-- 任务4：手动分章工具 -->
            <div class="manual-chapter-tools">
              <div class="tool-section">
                <h4>自定义规则</h4>
                <div class="custom-rule-input">
                  <input type="text" id="customRuleInput" class="form-input" placeholder="输入关键词或正则表达式">
                  <button id="applyCustomRuleButton" class="tool-button">应用</button>
                </div>
              </div>
              <div class="tool-section">
                <h4>章节操作</h4>
                <div class="chapter-operation-buttons">
                  <button id="splitChapterButton" class="tool-button" title="在光标位置拆分章节">拆分章节</button>
                  <button id="mergeChaptersButton" class="tool-button" title="合并选中的章节">合并章节</button>
                </div>
              </div>
            </div>
            <div class="chapter-list-content" id="chapterListContent">
              <div class="chapter-list-loading" id="chapterListLoading">
                <p>请先点击"章节检测"按钮</p>
              </div>
              <ul class="chapter-list" id="chapterList" style="display: none;">
                <!-- 章节列表将通过JavaScript动态生成 -->
                <!-- 在index.html文件中，找到章节列表项的生成部分，修改为以下内容 -->
                <!-- 章节列表项将通过JavaScript动态生成，但需要确保包含以下元素 -->
                <li class="chapter-item" data-index="CHAPTER_INDEX">
                  <input type="checkbox" class="chapter-checkbox">
                  <span class="chapter-number">CHAPTER_NUMBER.</span>
                  <span class="chapter-title" id="chapter-title-CHAPTER_INDEX">CHAPTER_TITLE</span>
                  <input type="text" class="chapter-title-input" id="chapter-title-input-CHAPTER_INDEX"
                    value="CHAPTER_TITLE" style="display: none;">
                  <button class="chapter-edit-button" id="chapter-edit-CHAPTER_INDEX" title="编辑章节名">✏️</button>
                  <button class="chapter-delete-button" id="chapter-delete-CHAPTER_INDEX" title="删除章节">🗑️</button>
                  <span class="chapter-toggle">▼</span>
                </li>

              </ul>
            </div>
          </div>

          <!-- 在index.html文件中，找到编辑器工具栏的部分，添加以下内容 -->
          <div class="editor-toolbar">
            <div class="toolbar-group">
              <button class="toolbar-button" id="undoButton" title="撤销">↶</button>
              <button class="toolbar-button" id="redoButton" title="重做">↷</button>
            </div>
            <div class="toolbar-group">
              <button class="toolbar-button" id="findButton" title="查找">🔍</button>
              <button class="toolbar-button" id="replaceButton" title="替换">⇄</button>
            </div>
            <div class="toolbar-group">
              <button class="toolbar-button" id="chapterDetectButton" title="章节检测">📖</button>
            </div>
            <!-- 任务2：内容优化工具 -->
            <div class="toolbar-group">
              <button class="toolbar-button" id="removeEmptyLinesButton" title="去空行">📝</button>
              <button class="toolbar-button" id="optimizeIndentButton" title="缩进优化">↹</button>
            </div>
            <!-- 任务1：本地保存功能 -->
            <div class="toolbar-group">
              <button class="toolbar-button" id="saveButton" title="手动保存">💾</button>
              <button class="toolbar-button" id="autoSaveToggle" title="自动保存">⏱️</button>
              <button class="toolbar-button" id="exportTxtButton" title="导出TXT文件">📤</button>
              <button class="toolbar-button" id="backToDocumentsButton" title="返回文档列表">📚</button>
            </div>
          </div>
          <div class="editor-content">
            <textarea id="textEditor" placeholder="在此编辑文本内容..."></textarea>
          </div>
        </div>

        <!-- 右侧预览区 -->
        <div class="preview-pane" id="previewPane">
          <div class="preview-header">
            <h3>全文预览</h3>
            <div class="preview-controls">
              <button class="preview-button" id="zoomInButton">放大</button>
              <button class="preview-button" id="zoomOutButton">缩小</button>
              <button class="preview-button" id="resetZoomButton">重置</button>
            </div>
          </div>
          <div class="preview-content" id="previewContent">
            <div class="preview-text" id="previewText"></div>
          </div>
        </div>
  </div>

  <!-- 底部状态栏 -->
  <div class="status-bar">
    <div class="status-left">
      <span id="encodingInfo"></span>
      <span id="lineInfo"></span>
    </div>
    <div class="status-right">
      <span id="wordCount"></span>
    </div>
  </div>
  </section>
  </main>
  </div>

  <!-- 查找替换对话框 -->
  <div class="dialog" id="findReplaceDialog" hidden>
    <div class="dialog-content">
      <div class="dialog-header">
        <h3>查找与替换</h3>
        <button class="dialog-close" id="dialogClose">×</button>
      </div>
      <div class="dialog-body">
        <div class="form-group">
          <label for="findInput">查找内容:</label>
          <input type="text" id="findInput" class="form-input">
        </div>
        <div class="form-group">
          <label for="replaceInput">替换为:</label>
          <input type="text" id="replaceInput" class="form-input">
        </div>
        <div class="form-options">
          <label class="checkbox-label">
            <input type="checkbox" id="caseSensitive"> 区分大小写
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="wholeWord"> 全词匹配
          </label>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="dialog-button" id="findNextButton">查找下一个</button>
        <button class="dialog-button" id="replaceNextButton">替换下一个</button>
        <button class="dialog-button" id="replaceAllButton">全部替换</button>
      </div>
    </div>
  </div>

  <!-- 导出设置对话框 -->
  <div class="dialog" id="exportSettingsDialog" hidden>
    <div class="dialog-content">
      <div class="dialog-header">
        <h3>导出设置</h3>
        <button class="dialog-close" id="exportDialogClose">×</button>
      </div>
      <div class="dialog-body">
        <div class="form-group">
          <label for="exportFileName">文件名:</label>
          <input type="text" id="exportFileName" class="form-input" value="未命名文档.txt">
        </div>
        <div class="form-options">
          <label class="checkbox-label">
            <input type="checkbox" id="includeChapterNames" checked> 包含章节名
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="preserveEmptyLines" checked> 保留原空行
          </label>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="dialog-button" id="cancelExportButton">取消</button>
        <button class="dialog-button" id="confirmExportButton">导出</button>
      </div>
    </div>
  </div>

  <!-- 阅读模式设置对话框 -->
  <div class="dialog" id="readingModeDialog" hidden>
    <div class="dialog-content">
      <div class="dialog-header">
        <h3>阅读模式设置</h3>
        <button class="dialog-close" id="readingDialogClose">×</button>
      </div>
      <div class="dialog-body">
        <div class="form-group">
          <label for="fontFamily">字体:</label>
          <select id="fontFamily" class="form-input">
            <option value="'Microsoft YaHei', sans-serif">微软雅黑</option>
            <option value="'SimSun', serif">宋体</option>
            <option value="'SimHei', sans-serif">黑体</option>
            <option value="'KaiTi', serif">楷体</option>
            <option value="'Consolas', 'Monaco', monospace">等宽字体</option>
          </select>
        </div>
        <div class="form-group">
          <label for="fontSize">字体大小:</label>
          <input type="range" id="fontSize" class="form-input" min="12" max="24" value="16">
          <span id="fontSizeValue">16px</span>
        </div>
        <div class="form-group">
          <label for="lineHeight">行距:</label>
          <input type="range" id="lineHeight" class="form-input" min="1.2" max="2.5" step="0.1" value="1.6">
          <span id="lineHeightValue">1.6</span>
        </div>
        <div class="form-group">
          <label for="backgroundColor">背景颜色:</label>
          <input type="color" id="backgroundColor" class="form-input" value="#ffffff">
        </div>
        <div class="form-group">
          <label for="textColor">文字颜色:</label>
          <input type="color" id="textColor" class="form-input" value="#333333">
        </div>
      </div>
      <div class="dialog-footer">
        <button class="dialog-button" id="resetReadingSettings">重置</button>
        <button class="dialog-button" id="applyReadingSettings">应用</button>
      </div>
    </div>
  </div>

  <!-- 加载动画 -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>

  <!-- 消息提示容器 -->
  <div id="messageContainer"></div>

  <!-- 功能测试部分 -->
  <div class="test-section">
    <h3>功能测试</h3>
    <button id="runTestsButton" class="control-button">运行功能测试</button>
    <div id="testResults" class="test-results"></div>
  </div>

  <!-- 兼容性测试部分 -->
  <div class="test-section">
    <h3>兼容性测试</h3>
    <button id="runCompatibilityTestsButton" class="control-button">运行兼容性测试</button>
    <div id="compatibilityResults" class="test-results"></div>
  </div>

  <!-- 优化迭代部分 -->
  <div class="test-section">
    <h3>优化迭代</h3>
    <button id="runOptimizationButton" class="control-button">运行优化分析</button>
    <div id="optimizationResults" class="test-results"></div>
  </div>

  <script src="js/fileHandler.js"></script>
  <script src="js/chapterDetector.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/editor.js"></script>
  <script src="js/testCases.js"></script>
  <script src="js/testRunner.js"></script>
  <script src="js/compatibilityTest.js"></script>
  <script src="js/optimizationEngine.js"></script>
  <script src="js/app.js"></script>

</body>

</html>